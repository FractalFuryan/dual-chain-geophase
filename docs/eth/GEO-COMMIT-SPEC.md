# GeoCommit Specification v1

**Status:** Living Standard  
**Version:** 1.0  
**Chain:** Base (L2)  
**Purpose:** Privacy-safe provenance commitments for GeoPhase dual-chain outputs

---

## 1. Overview

GeoCommit is a **commitment-only** on-chain attestation system for GeoPhase procedural generation. It stores cryptographic hashes that prove:

- ✅ A specific output was generated from a specific seed + phase vectors
- ✅ Generation adhered to a specific ethics policy
- ✅ Output can be regenerated by authorized parties
- ❌ **No media, no user data, no likeness stored on-chain**

---

## 2. Commitment Structure

### 2.1 Primary Commitment (`geoCommit`)

The on-chain key is computed as:

```
geoCommit = keccak256(
    "ANANKE_GEO_COMMIT_V1" ||
    seed_commit ||
    phaseA_hash ||
    phaseB_hash ||
    policyId ||
    version
)
```

**Components:**

| Field | Type | Description |
|-------|------|-------------|
| `seed_commit` | bytes32 | sha256(seed \|\| user_nonce) |
| `phaseA_hash` | bytes32 | sha256(phaseA_vector_bytes) |
| `phaseB_hash` | bytes32 | sha256(phaseB_vector_bytes) |
| `policyId` | bytes32 | Ethics policy identifier (keccak256) |
| `version` | uint32 | Protocol version (1 for v1) |

### 2.2 Component Hashes

#### Seed Commitment
```python
seed_commit = sha256(seed || user_nonce)
```

- `seed`: Raw seed bytes (e.g., 32-byte random value)
- `user_nonce`: User-specific nonce (prevents rainbow tables)

#### Phase Vector Hashes
```python
phaseA_hash = sha256(phaseA_vector_bytes)
phaseB_hash = sha256(phaseB_vector_bytes)
```

- Serialization: Use consistent byte packing (e.g., IEEE 754 float64 big-endian)
- Vectors are **never** stored on-chain

#### Ethics Anchor
```python
ethics_anchor = keccak256(ethics_doc || timestamp)
```

- `ethics_doc`: Policy document (UTF-8) or IPFS hash
- `timestamp`: Unix timestamp (uint64, big-endian)

#### Policy ID
```python
policyId = keccak256("ANANKE_POLICY_" || policy_name || version)
```

Examples:
- `ANANKE_POLICY_clinical_v1`
- `ANANKE_POLICY_entertainment_v2`

---

## 3. On-Chain Storage

### 3.1 Attestation Registry

**Contract:** `AnankeAttestationRegistry.sol`

```solidity
struct Attestation {
    bytes32 ethicsAnchor;   // Ethics policy commitment
    bytes32 policyId;       // Policy identifier
    uint32 version;         // Protocol version
    address attestor;       // Who attested
    uint64 timestamp;       // When attested (block.timestamp)
}

mapping(bytes32 => Attestation) public attestations;
```

**Write-once semantics:** Each `geoCommit` can only be attested once.

### 3.2 Revocation Registry

**Contract:** `AnankeRevocationRegistry.sol`

```solidity
mapping(bytes32 => bool) public revoked;
```

**Revocation keys:**
- `geoCommit` (for regeneration blocking)
- `tokenId` (for NFT rights revocation, future)

---

## 4. Privacy Guarantees

### What is NOT on-chain:
- ❌ Raw seeds
- ❌ Phase vectors (geometric coordinates)
- ❌ Generated media (images/videos)
- ❌ User identifiers (names, addresses, biometrics)
- ❌ Procedural preset details
- ❌ Intermediate computation states

### What IS on-chain:
- ✅ Cryptographic commitments (hashes)
- ✅ Policy identifiers (non-sensitive)
- ✅ Protocol version numbers
- ✅ Timestamps
- ✅ Revocation bits

### Attack Resistance:
- **Rainbow tables:** Prevented by `user_nonce` in seed commits
- **Linkability:** Each `geoCommit` is unique (no cross-user correlation)
- **Inference:** Hashes are one-way (no data leakage)

---

## 5. Verification Flow

### 5.1 Pre-Generation Check

```python
from geophase.eth import compute_geo_commit, ChainClient

# Compute commitment
params = GeoCommitParams(
    seed_commit=seed_commit,
    phaseA_hash=phaseA_hash,
    phaseB_hash=phaseB_hash,
    policy_id=policy_id,
    version=1
)
geo_commit = compute_geo_commit(params)

# Check revocation
client = ChainClient(config)
if client.is_revoked(geo_commit):
    raise Exception("GeoCommit revoked")

# Proceed with generation...
```

### 5.2 Post-Generation Attestation (Optional)

```python
# After successful generation
tx_hash = client.attest(
    geo_commit=geo_commit,
    ethics_anchor=ethics_anchor,
    policy_id=policy_id,
    version=1
)
```

---

## 6. Use Cases

### 6.1 Clinical Applications
- Attest that a medical visualization adhered to clinical ethics
- Enable audit trails without storing patient data
- Revoke if consent is withdrawn

### 6.2 Entertainment
- Prove authenticity of procedural content
- Enable regeneration rights trading (future NFT layer)
- Block redistribution of revoked content

### 6.3 Research
- Timestamped provenance for academic outputs
- Reproducibility without data exposure
- Ethics compliance verification

---

## 7. Gas Costs (Base L2)

| Operation | Estimated Gas | Cost (~$0.01/gas) |
|-----------|---------------|-------------------|
| `attest()` | ~100,000 | ~$0.10 |
| `revoke()` | ~50,000 | ~$0.05 |
| `isRevoked()` (read) | 0 (free) | $0 |

---

## 8. Implementation Notes

### Python Example
```python
from geophase.eth import (
    compute_geo_commit,
    compute_seed_commit,
    compute_phase_hash,
    GeoCommitParams,
)

# Compute components
seed_commit = compute_seed_commit(seed, user_nonce)
phaseA_hash = compute_phase_hash(phaseA_vector_bytes)
phaseB_hash = compute_phase_hash(phaseB_vector_bytes)

# Compute geoCommit
params = GeoCommitParams(
    seed_commit=seed_commit,
    phaseA_hash=phaseA_hash,
    phaseB_hash=phaseB_hash,
    policy_id=policy_id_bytes,
    version=1
)
geo_commit = compute_geo_commit(params)
```

### Solidity Verification (Future)
```solidity
function verifyGeoCommit(
    bytes32 geoCommit,
    bytes32 seedCommit,
    bytes32 phaseAHash,
    bytes32 phaseBHash,
    bytes32 policyId,
    uint32 version
) public pure returns (bool) {
    bytes32 computed = keccak256(abi.encodePacked(
        "ANANKE_GEO_COMMIT_V1",
        seedCommit,
        phaseAHash,
        phaseBHash,
        policyId,
        version
    ));
    return computed == geoCommit;
}
```

---

## 9. Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2026-01 | Initial specification |

---

## 10. References

- [EIP-712: Typed structured data hashing](https://eips.ethereum.org/EIPS/eip-712)
- [Base Network](https://base.org)
- [GeoPhase Mathematics](../MATHEMATICS.md)
- [DNA Ledger Ethics Framework](../SECURITY.md)

---

**Contact:** FractalFuryan  
**License:** MIT
